---
# Service-specific variables for {{ service_name }} - tor-proxy

# Proxmox Configuration
proxmox_host: "{{ lookup('env', 'PROXMOX_HOST') | default('192.168.1.100') }}"
proxmox_user: "{{ lookup('env', 'PROXMOX_USER') | default('root@pam') }}"
proxmox_password: "{{ lookup('env', 'PROXMOX_PASSWORD') }}"
proxmox_node: "{{ proxmox_node_override | default(lookup('env', 'PROXMOX_NODE')) | default('proxmox') }}"
proxmox_api_validate_certs: false

# Proxmox API Token Authentication
proxmox_token_id: "{{ lookup('env', 'TOKEN_ID') | default('') }}"
proxmox_token_secret: "{{ lookup('env', 'TOKEN_SECRET') | default('') }}"

# Service-specific configuration
service_name: {{ service_name }}
vm_name: {{ vm_name }}
vm_id: {{ vm_id }}
vm_cores: {{ vm_cores | default(2) }}
vm_memory: {{ vm_memory | default(2048) }}  # MB
vm_disk_size: {{ vm_disk_size | default(20) }}  # GB
vm_storage: {{ vm_storage | default('local-lvm') }}
vm_os_template: "{{ lookup('env', 'VM_TEMPLATE') | default('local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst') }}"

# Network Configuration  
vm_network_bridge: {{ vm_network_bridge | default('vmbr0') }}
vm_swap: {{ vm_swap | default(512) }}  # MB
vm_unprivileged: {{ vm_unprivileged | default(true) }}

# Application/Proxy Configuration
app_name: {{ service_name }}
app_user: {{ app_user | default('appuser') }}
app_dir: {{ app_dir }}
app_service_name: {{ app_service_name }}
app_port: {{ app_port }}       # Tor SOCKS5
http_proxy_port: 8118  # Privoxy HTTP

# Service type (concrete)
service_type: tor-proxy

# Local source path (unused but kept for consistency)
local_app_path: "{{ local_app_path }}"

# Security / firewall
ssh_public_key_path: "{{ ansible_env.HOME }}/.ssh/id_proxmox.pub"
allowed_ports:
  - "22"
  - "{{ app_port }}"      # SOCKS5
  - "{{ http_proxy_port }}"  # HTTP proxy

# DNS Configuration
dns_server: "{{ dns_server | default('192.168.1.11') }}"
dns_domain: "{{ dns_domain | default('proxmox.local') }}"
service_hostname: "{{ service_hostname }}"

# Container Tagging Configuration
project_tag: "{{ lookup('env', 'PROJECT_TAG') | default('') }}"
container_tags: "{{ ['proxmox-deploy', service_name] + ([project_tag] if project_tag != '' else []) }}"
container_tags_string: "{{ container_tags | join(',') }}"


