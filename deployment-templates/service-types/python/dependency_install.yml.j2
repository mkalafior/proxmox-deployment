# Python Dependency Installation Tasks
- name: Check if requirements.txt exists
  stat:
    path: "{{ app_dir }}/requirements.txt"
  register: requirements_file_exists

- name: Create Python virtual environment
  shell: python3 -m venv venv
  args:
    chdir: "{{ app_dir }}"
    creates: "{{ app_dir }}/venv"
  become_user: "{{ app_user }}"

- name: Install Python dependencies
  shell: |
    source venv/bin/activate
    pip install -r requirements.txt
  args:
    chdir: "{{ app_dir }}"
  become_user: "{{ app_user }}"
  when: requirements_file_exists.stat.exists
