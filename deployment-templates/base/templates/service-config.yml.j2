# Service configuration for {{ service_name }}
# Generated by proxmox-deploy

# Service Identity
service_name: {{ service_name }}
service_type: {{ service_type }}
service_hostname: {{ service_hostname }}
app_subdomain: {{ app_subdomain | default('') }}

# VM Configuration
vm_name: {{ vm_name }}
vm_id: {{ vm_id }}
vm_cores: {{ vm_cores }}
vm_memory: {{ vm_memory }}
vm_disk_size: {{ vm_disk_size }}
vm_storage: {{ vm_storage }}
vm_network_bridge: {{ vm_network_bridge }}
vm_swap: {{ vm_swap }}
vm_unprivileged: {{ vm_unprivileged }}
container_type: lxc

# Application Configuration
app_name: {{ app_name }}
app_user: {{ app_user }}
app_dir: {{ app_dir }}
app_service_name: {{ app_service_name }}
app_port: {{ app_port }}
{% if service_type in ['nodejs'] %}
app_main_file: {{ app_main_file }}
{% endif %}
local_app_path: "{{ local_app_path }}"

# DNS Configuration (can override global defaults)
# dns_server: {{ dns_server | default('192.168.1.11') }}
# dns_domain: {{ dns_domain | default('proxmox.local') }}

# Proxmox node override (leave empty to use global default)
proxmox_node: {{ proxmox_node }}

# Service type specific configuration
{% if runtime_variant is defined and runtime_variant != '' %}
{{ service_type }}_runtime: {{ runtime_variant }}
{% endif %}

{% if service_type == 'database' %}
# Database configuration
db_name: {{ service_name | replace('-', '_') }}
db_user: {{ service_name | replace('-', '_') }}_user
# Secure password from Ansible Vault (encrypted, safe to commit)
db_password: "{{ '{{' }} vault_passwords['{{ service_name }}'] {{ '}}' }}"
{% endif %}

# Additional ports to open in firewall
additional_ports: []

# Health check configuration
# Override the default health check path from service type if needed
# health_check_path: "/custom/health"

# Container environment variables
# Core settings are auto-configured - avoid changing unless needed
container_env:
{% if service_type in ['nodejs'] %}
  # Node.js/Bun specific settings (auto-configured)
  NODE_ENV: "production"     # Environment mode
{% endif %}
  # Application settings (auto-configured)
  PORT: "{{ app_port }}"     # Application port
  HOST: "0.0.0.0"           # Bind to all interfaces
  
  # Add your custom environment variables below:
  # DATABASE_URL: "postgresql://user:pass@localhost:5432/dbname"
  # API_KEY: "your-api-key-here"
{% if service_type == 'python' %}
  # PYTHONPATH: "/opt/{{ service_name }}"
  # FLASK_ENV: "production"
{% elif service_type == 'golang' %}
  # CGO_ENABLED: "0"
  # GOOS: "linux"
{% endif %}

# Container tags (merged with global defaults)
container_tags: ["proxmox-deploy", "{{ service_name }}"]
