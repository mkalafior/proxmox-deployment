---
# Global variables for Proxmox deployment

# Proxmox Configuration
proxmox_host: "{{ lookup('env', 'PROXMOX_HOST') | default('192.168.1.100') }}"
proxmox_user: "{{ lookup('env', 'PROXMOX_USER') | default('root@pam') }}"
proxmox_password: "{{ lookup('env', 'PROXMOX_PASSWORD') }}"
proxmox_node: "{{ lookup('env', 'PROXMOX_NODE') | default('proxmox') }}"
proxmox_api_validate_certs: false

# Proxmox API Token Authentication (preferred for automation)
proxmox_token_id: "{{ lookup('env', 'TOKEN_ID') | default('') }}"
proxmox_token_secret: "{{ lookup('env', 'TOKEN_SECRET') | default('') }}"

# VM Configuration
vm_name: hello-world-bun-app
vm_id: "{{ lookup('env', 'VM_ID') | default(200) | int }}"
vm_cores: 2
vm_memory: 2048  # MB
vm_disk_size: 20  # GB
vm_storage: local-lvm
vm_os_template: "{{ lookup('env', 'VM_TEMPLATE') | default('local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst') }}"

# Network Configuration  
vm_network_bridge: vmbr0
# Always use DHCP for dynamic IP assignment

# Application Configuration
app_name: hello-world-bun-app
app_user: bunapp
app_dir: /opt/hello-world-bun-app
app_service_name: hello-world-bun-app
app_port: 3000

# Local source code path
local_app_path: "../"  # Path to your app directory relative to deployment

# Production Environment Variables
production_env:
  NODE_ENV: production
  PORT: "{{ app_port }}"
  HOST: "0.0.0.0"

# Security Configuration
ssh_public_key_path: "{{ ansible_env.HOME }}/.ssh/id_proxmox.pub"
allowed_ports:
  - "22"    # SSH
  - "{{ app_port }}"  # Application port
  - "80"    # HTTP (for future use)
  - "443"   # HTTPS (for future use)

# Container/VM startup configuration
vm_startup_order: ""  # Leave empty for default, or set startup order
vm_startup_delay: 0   # Delay in seconds

# Resource limits (for containers)
vm_swap: 512  # MB
vm_unprivileged: true  # Run as unprivileged container (recommended)

# Features for containers
vm_features:
  - nesting=1      # Allow nested virtualization
  - keyctl=1       # Allow keyctl syscall

# Backup configuration (optional)
vm_backup: false
vm_backup_schedule: ""  # Cron format: "0 2 * * *" for daily at 2 AM
